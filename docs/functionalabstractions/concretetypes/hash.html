<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Hash · ZIO Prelude</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="`Hash[A]` describes the ability to hash a value of type `A`."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Hash · ZIO Prelude"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.github.io/zio-prelude/"/><meta property="og:description" content="`Hash[A]` describes the ability to hash a value of type `A`."/><meta property="og:image" content="https://zio.github.io/zio-prelude/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://zio.github.io/zio-prelude/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/zio-prelude/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/zio-prelude/js/scrollSpy.js"></script><link rel="stylesheet" href="/zio-prelude/css/main.css"/><script src="/zio-prelude/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zio-prelude/"><img class="logo" src="/zio-prelude/img/navbar_brand2x.png" alt="ZIO Prelude"/><h2 class="headerTitleWithLogo">ZIO Prelude</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zio-prelude/docs/overview/overview_index" target="_self">Overview</a></li><li class="siteNavGroupActive"><a href="/zio-prelude/docs/functionalabstractions/" target="_self">Functional Abstractions</a></li><li class=""><a href="/zio-prelude/docs/functionaldatatypes/" target="_self">Functional Data Types</a></li><li class=""><a href="/zio-prelude/docs/newtypes/" target="_self">New Types</a></li><li class=""><a href="/zio-prelude/docs/zpure/" target="_self">ZPure</a></li><li class=""><a href="/zio-prelude/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class=""><a href="/zio-prelude/docs/about/about_index" target="_self">About</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Concrete Types</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concrete Types</h3><ul class=""><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/associative">Associative</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/commutative">Commutative</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/equal">Equal</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/hash">Hash</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/identity">Identity</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/inverse">Inverse</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/concretetypes/ord">Ord</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Parameterized Types</h3><ul class=""><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/associativeboth">AssociativeBoth</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/associativeeither">AssociativeEither</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/associativeflatten">AssociativeFlatten</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/commutativeboth">CommutativeBoth</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/commutativeeither">CommutativeEither</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/contravariant">Contravariant</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/covariant">Covariant</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/foreach">ForEach</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/identityboth">IdentityBoth</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/identityeither">IdentityEither</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/identityflatten">IdentityFlatten</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/invariant">Invariant</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/functionalabstractions/parameterizedtypes/nonemptyforeach">NonEmptyForEach</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Hash</h1></header><article><div><span><p><code>Hash[A]</code> describes the ability to hash a value of type <code>A</code>.</p>
<p>The signature is:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Equal</span>[-<span class="hljs-type">A</span>] </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">equal</span></span>(left: <span class="hljs-type">A</span>, right: <span class="hljs-type">A</span>): <span class="hljs-type">Boolean</span>
}

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Hash</span>[-<span class="hljs-type">A</span>] <span class="hljs-keyword">extends</span> <span class="hljs-title">Equal</span>[<span class="hljs-type">A</span>] </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">equal</span></span>(left: <span class="hljs-type">A</span>, right: <span class="hljs-type">A</span>): <span class="hljs-type">Boolean</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hash</span></span>(a: <span class="hljs-type">A</span>): <span class="hljs-type">Int</span>
}
</code></pre>
<p><code>Hash</code> builds on <code>Equal</code> in a different way than <code>Ord</code> by defining a way to <code>Hash</code> two values of type <code>A</code> in addition to a way to compare them for equality.</p>
<p>If we import <code>zio.prelude._</code> We can hash any data type that has a <code>Hash</code> instance defined for it using the <code>hash</code> operator or its symbolic alias <code>##</code>.</p>
<p>In addition to hashing being generally useful, hashing allows us to determine whether a value already exists in a collection of values without individually testing for equality with each value. This allows us to implement some operators that would not otherwise be practical if all we could do was compare values for equality pairwise.</p>
<p>The <code>Hash</code> abstraction provides similar functionality as the <code>hashCode</code> operator defined on any object in Scala with a few advantages.</p>
<p>First, it allows us to specify whether a data type has a meaningful definition of hash code.</p>
<p>For example, we can call <code>hashCode</code> on a Scala function but there is not a meaningful way of comparing Scala functions for equality so the definition of <code>hashCode</code> is just based on reference equality.</p>
<p>While this could potentially be useful in some very low level parts of our code this is generally a potential source of bugs if we are not specifically trying to use reference equality. ZIO Prelude just doesn't define a <code>Hash</code> instance for functions so this can never happen.</p>
<p>Second, we can use the <code>Hash</code> abstraction to define strategies for hashing data types that are not in our control. An existing data type may implement <code>hashCode</code> in a way that doesn't make sense or is not what we want for whatever reason (e.g. creates too high a rate of hash collisions, is vulnerable to attacks, etc...).</p>
<p>With just the <code>hashCode</code> defined in the Scala standard library we don't have any way of fixing this other than creating a new wrapper for the data type, which has potential performance implications and may require boilerplate in wrapping and unwrapping the new type or reimplementing existing methods. In contrast, with ZIO Prelude defining a different hashing strategy is as simple as implementing a new instance.</p>
<p>Third, the <code>Hash</code> abstraction guarantees that our definition of hashing is consistent with our definition of equality. That is, if two values are equal they should always have the same hash code.</p>
<p>This is another common source of errors whenever we implement our own definition of <code>equals</code> and <code>hashCode</code> and ZIO Prelude can prevent it by automatically checking that all instances of <code>Hash</code> define a consistent notion of equality and hashing.</p>
<p>For example, here is how we could test that ZIO Prelude's notions of hashing and equality for strings are consistent.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.prelude.<span class="hljs-type">Hash</span>
<span class="hljs-keyword">import</span> zio.prelude.laws.<span class="hljs-type">HashLaws</span>
<span class="hljs-keyword">import</span> zio.test._
<span class="hljs-keyword">import</span> zio.test.laws._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">HashSpec</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultRunnableSpec</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">spec</span> </span>= suite(<span class="hljs-string">"HashSpec"</span>) {
    test(<span class="hljs-string">"StringHash"</span>) {
      <span class="hljs-keyword">val</span> stringGen = <span class="hljs-type">Gen</span>.string
      checkAllLaws(<span class="hljs-type">HashLaws</span>)(stringGen)
    }
  }
}
</code></pre>
<p>This will automatically generate a large number of string values and test that the definition of hashing is consistent with equality for all of them, reporting any failures.</p>
<h2><a class="anchor" aria-hidden="true" id="defining-hash-instances"></a><a href="#defining-hash-instances" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining Hash Instances</h2>
<p>ZIO Prelude automatically includes instances of <code>Hash</code> for all data types in ZIO and the Scala standard library that support a meaningful definition of hashing. This also includes types like collections, tuples, and sum types like <code>Option</code> and <code>Either</code>.</p>
<p>If we are defining our own data types we can use the <code>default</code> operator if we want to use the definition of <code>equals</code> and <code>hashCode</code> already defined on the type. This can be particularly useful if we are defining case classes that are made up of</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>)</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Person</span> </span>{
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> <span class="hljs-type">PersonHash</span>: <span class="hljs-type">Hash</span>[<span class="hljs-type">Person</span>] =
    <span class="hljs-type">Hash</span>.<span class="hljs-keyword">default</span>
}
</code></pre>
<p>If we are defining a <code>Hash</code> instance for our own data type we can use the <code>make</code> operator, which allows you to provide your own definition of hashing and equality.</p>
<p>However, hashing can involve some low level logic so for the <code>Hash</code> abstraction it can be particularly nice to use the <code>contramap</code> operator.</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Hash</span>[-<span class="hljs-type">A</span>] </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">contramap</span></span>[<span class="hljs-type">B</span>](f: <span class="hljs-type">B</span> =&gt; <span class="hljs-type">A</span>): <span class="hljs-type">Hash</span>[<span class="hljs-type">B</span>]
}
</code></pre>
<p>The <code>contramap</code> operator says if we know how to turn a <code>B</code> value into an <code>A</code> value and we know how to hash an <code>A</code> value then we can hash a <code>B</code> value simply by turning it into an <code>A</code> value and hashing that.</p>
<p>This turns out to be quite useful because we can convert almost any date type we define into some data type in ZIO or the Scala library that there is already a <code>Hash</code> instance defined for. The function <code>f</code> should be information preserving so if we have two <code>A</code> values that are not equal they should map to two <code>B</code> values that are not equal and if we have two <code>A</code> values that are equal they should map to two <code>B</code> values that are equal.</p>
<p>For example, here is how we can use <code>contramap</code> to easily define a <code>Hash</code> instance for a custom data type to keep track of different topics and the number of votes for each of them.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.prelude.<span class="hljs-type">Hash</span>

<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topic</span>(<span class="hljs-params">value: <span class="hljs-type">String</span></span>)</span>

<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Votes</span>(<span class="hljs-params">value: <span class="hljs-type">Int</span></span>)</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Votes</span> </span>{
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> <span class="hljs-type">VotesHash</span>: <span class="hljs-type">Hash</span>[<span class="hljs-type">Votes</span>] =
    <span class="hljs-type">Hash</span>.<span class="hljs-keyword">default</span>
}

<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VoteMap</span>(<span class="hljs-params">map: <span class="hljs-type">Map</span>[<span class="hljs-type">Topic</span>, <span class="hljs-type">Votes</span>]</span>)</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">VoteMap</span> </span>{
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> <span class="hljs-type">VoteMapHash</span>: <span class="hljs-type">Hash</span>[<span class="hljs-type">VoteMap</span>] =
    <span class="hljs-type">Hash</span>[<span class="hljs-type">Map</span>[<span class="hljs-type">Topic</span>, <span class="hljs-type">Votes</span>]].contramap(_.map)
}
</code></pre>
<p>ZIO Prelude knows how to hash values of type <code>Map[A, B]</code> as long as there is a way of hashing the values in the map. And we know how to hash the values in the map because we defined a <code>Hash</code> instance for <code>Votes</code>.</p>
<p>So all we have to do is tell ZIO Prelude how to convert our <code>VoteMap</code> into a <code>Map</code>, which is quite easy because a <code>VoteMap</code> just wraps a map!</p>
<p>This strategy turns out to be quite general because there are <code>Hash</code> instances defined on so many data types such as collection types, product types like tuples, sum types like <code>Either</code> and <code>Option</code>, and primitive types. We can almost always convert our data type to some combination of those types.</p>
<p>By doing this we can easily define which data types it makes sense to hash, control the hashing strategies we use, and integrate hashing with the other functional abstractions in ZIO Prelude.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/zio-prelude/docs/functionalabstractions/concretetypes/equal"><span class="arrow-prev">← </span><span>Equal</span></a><a class="docs-next button" href="/zio-prelude/docs/functionalabstractions/concretetypes/identity"><span>Identity</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#defining-hash-instances">Defining Hash Instances</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/zio-prelude/" class="nav-home"><img src="/zio-prelude/img/sidebar_brand2x.png" alt="ZIO Prelude"/></a><div><h5>GitHub</h5><a class="github-button" href="https://github.com/zio/zio-prelude" data-icon="octicon-star" data-count-href="/zio/zio-prelude/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="/zio-prelude//img/discord.png" width="120" alt="discord"/></a></div><div><h5>Additional resources</h5><a href="/zio-prelude/api/zio/prelude/">Scaladoc of zio-prelude</a></div></section><section class="copyright">Copyright © 2022 ZIO Maintainers</section></footer></div></body></html>